<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB6tDk5i...",
            authDomain: "thenordschannel.firebaseapp.com",
            projectId: "thenordschannel",
            storageBucket: "thenordschannel.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentUser, otherUser;

        document.getElementById("login-button").addEventListener("click", async function() {
            const inputName = document.getElementById("user-name-input").value.trim().toLowerCase();
            if (inputName === "sheena") {
                currentUser = { name: "Sheena", img: "images/sheena.jpg" };
                otherUser = { name: "Nord", img: "images/nord.jpg" };
            } else if (inputName === "nord") {
                currentUser = { name: "Nord", img: "images/nord.jpg" };
                otherUser = { name: "Sheena", img: "images/sheena.jpg" };
            } else {
                document.getElementById("login-error").style.display = "block";
                return;
            }
            initChat();
        });

        function initChat() {
            document.getElementById("chat-container").style.display = "flex";
            document.getElementById("login-modal").style.display = "none";
            loadMessages();
        }

        function loadMessages() {
            const chatList = document.getElementById("chat-list");
            chatList.innerHTML = "";
            const q = query(collection(db, "messages"), orderBy("sentAt"));
            onSnapshot(q, (snapshot) => {
                chatList.innerHTML = "";
                snapshot.forEach((doc) => {
                    const msg = doc.data();
                    const li = document.createElement("li");
                    li.classList.add("chat-bubble", msg.sender === currentUser.name ? "outgoing" : "incoming");
                    li.innerHTML = `<span>${msg.content}</span>
                        <div class="bubble-footer">
                            ${new Date(msg.sentAt?.toDate()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })} 
                            ${msg.isRead ? "✔✔" : "✔"}
                        </div>`;
                    chatList.appendChild(li);
                });
                document.getElementById("chat-messages").scrollTop = chatList.scrollHeight;
            });
        }

        document.getElementById("chat-form").addEventListener("submit", async function(e) {
            e.preventDefault();
            const contentEl = document.getElementById("content");
            const text = contentEl.value.trim();
            if (!text) return;
            await addDoc(collection(db, "messages"), {
                sender: currentUser.name,
                receiver: otherUser.name,
                content: text,
                sentAt: serverTimestamp(),
                isRead: false
            });
            contentEl.value = "";
        });
    </script>
</head>
<body>
    <div id="login-modal">
        <input type="text" id="user-name-input" placeholder="Enter your name">
        <button id="login-button">Login</button>
        <p id="login-error" style="display: none; color: red;">Invalid username</p>
    </div>
    <div id="chat-container" style="display: none;">
        <ul id="chat-list"></ul>
        <form id="chat-form">
            <input type="text" id="content" placeholder="Type a message...">
            <button type="submit">Send</button>
        </form>
    </div>
</body>
</html>
